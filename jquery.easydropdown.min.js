/*
* EASYDROPDOWN - A Drop-down Builder for Styleable Inputs and Menus
* Version: 2.1.5
* License: Creative Commons Attribution 3.0 Unported - CC BY 3.0
* http://creativecommons.org/licenses/by/3.0/
* This software may be used freely on commercial and non-commercial projects with attribution to the author/copyright holder.
* Author: Patrick Kunka
* Copyright 2013 Patrick Kunka, All Rights Reserved
*/

(function(e){function t(){this.isField=!0,this.down=!1,this.inFocus=!1,this.disabled=!1,this.cutOff=!1,this.hasLabel=!1,this.keyboardMode=!1,this.nativeTouch=!0,this.wrapperClass="dropdown",this.onChange=null}t.prototype={constructor:t,instances:{},init:function(t,n){var r=this;e.extend(r,n),r.$select=e(t),r.id=t.id,r.options=[],r.$options=r.$select.find("option"),r.isTouch="ontouchend"in document,r.$select.removeClass(r.wrapperClass+" dropdown"),r.$select.is(":disabled")&&(r.disabled=!0),r.$options.length&&(r.$options.each(function(t){var n=e(this);n.is(":selected")&&(r.selected={index:t,title:n.text()},r.focusIndex=t),n.hasClass("label")&&t==0?(r.hasLabel=!0,r.label=n.text(),n.attr("value","")):r.options.push({domNode:n[0],title:n.text(),value:n.val(),selected:n.is(":selected")})}),r.selected||(r.selected={index:0,title:r.$options.eq(0).text()},r.focusIndex=0),r.render())},render:function(){var t=this,n=t.isTouch&&t.nativeTouch?" touch":"",r=t.disabled?" disabled":"";t.$container=t.$select.wrap('<div class="'+t.wrapperClass+n+r+'"><span class="old"/></div>').parent().parent(),t.$active=e('<span class="selected">'+t.selected.title+"</span>").appendTo(t.$container),t.$carat=e('<span class="carat"/>').appendTo(t.$container),t.$scrollWrapper=e("<div><ul/></div>").appendTo(t.$container),t.$dropDown=t.$scrollWrapper.find("ul"),t.$form=t.$container.closest("form"),e.each(t.options,function(){var e=this,n=e.selected?' class="active"':"";t.$dropDown.append("<li"+n+">"+e.title+"</li>")}),t.$items=t.$dropDown.find("li"),t.cutOff&&t.$items.length>t.cutOff&&t.$container.addClass("scrollable"),t.getMaxHeight(),t.isTouch&&t.nativeTouch?t.bindTouchHandlers():t.bindHandlers()},getMaxHeight:function(){var e=this;e.maxHeight=0;for(i=0;i<e.$items.length;i++){var t=e.$items.eq(i);e.maxHeight+=t.outerHeight();if(e.cutOff==i+1)break}},bindTouchHandlers:function(){var t=this;t.$container.on("click.easyDropDown",function(){t.$select.focus()}),t.$select.on({change:function(){var n=e(this).find("option:selected"),r=n.text(),i=n.val();t.$active.text(r),typeof t.onChange=="function"&&t.onChange.call(t.$select[0],{title:r,value:i})},focus:function(){t.$container.addClass("focus")},blur:function(){t.$container.removeClass("focus")}})},bindHandlers:function(){var t=this;t.query="",t.$container.on({"click.easyDropDown":function(){!t.down&&!t.disabled?t.open():t.close()},"mousemove.easyDropDown":function(){t.keyboardMode&&(t.keyboardMode=!1)}}),e("body").on("click.easyDropDown."+t.id,function(n){var r=e(n.target),i=t.wrapperClass.split(" ").join(".");!r.closest("."+i).length&&t.down&&t.close()}),t.$items.on({"click.easyDropDown":function(){var n=e(this).index();t.select(n),t.$select.focus()},"mouseover.easyDropDown":function(){if(!t.keyboardMode){var n=e(this);n.addClass("focus").siblings().removeClass("focus"),t.focusIndex=n.index()}},"mouseout.easyDropDown":function(){t.keyboardMode||e(this).removeClass("focus")}}),t.$select.on({"focus.easyDropDown":function(){t.$container.addClass("focus"),t.inFocus=!0},"blur.easyDropDown":function(){t.$container.removeClass("focus"),t.inFocus=!1},"keydown.easyDropDown":function(e){if(t.inFocus){t.keyboardMode=!0;var n=e.keyCode;if(n==38||n==40||n==32)e.preventDefault(),n==38?(t.focusIndex--,t.focusIndex=t.focusIndex<0?t.$items.length-1:t.focusIndex):n==40&&(t.focusIndex++,t.focusIndex=t.focusIndex>t.$items.length-1?0:t.focusIndex),t.down||t.open(),t.$items.removeClass("focus").eq(t.focusIndex).addClass("focus"),t.cutOff&&t.scrollToView(),t.query="";if(t.down)if(n==9||n==27)t.close();else{if(n==13)return e.preventDefault(),t.select(t.focusIndex),t.close(),!1;if(n==8)return e.preventDefault(),t.query=t.query.slice(0,-1),t.search(),clearTimeout(t.resetQuery),!1;if(n!=38&&n!=40){var r=String.fromCharCode(n);t.query+=r,t.search(),clearTimeout(t.resetQuery)}}}},"keyup.easyDropDown":function(){t.resetQuery=setTimeout(function(){t.query=""},1200)}}),t.$dropDown.on("scroll.easyDropDown",function(e){t.$dropDown[0].scrollTop>=t.$dropDown[0].scrollHeight-t.maxHeight?t.$container.addClass("bottom"):t.$container.removeClass("bottom")}),t.$form.length&&t.$form.on("reset.easyDropDown",function(){var e=t.hasLabel?t.label:t.options[0].title;t.$active.text(e)})},unbindHandlers:function(){var t=this;t.$container.add(t.$select).add(t.$items).add(t.$form).add(t.$dropDown).off(".easyDropDown"),e("body").off("."+t.id)},open:function(){var e=this,t=window.scrollY||document.documentElement.scrollTop,n=window.scrollX||document.documentElement.scrollLeft,r=e.notInViewport(t);e.closeAll(),e.getMaxHeight(),e.$select.focus(),window.scrollTo(n,t+r),e.$container.addClass("open"),e.$scrollWrapper.css("height",e.maxHeight+"px"),e.down=!0},close:function(){var e=this;e.$container.removeClass("open"),e.$scrollWrapper.css("height","0px"),e.focusIndex=e.selected.index,e.query="",e.down=!1},closeAll:function(){var e=this,t=Object.getPrototypeOf(e).instances;for(var n in t){var r=t[n];r.close()}},select:function(e){var t=this;typeof e=="string"&&(e=t.$select.find("option[value="+e+"]").index());var n=t.options[e],r=t.hasLabel?e+1:e;t.$items.removeClass("active").eq(e).addClass("active"),t.$active.text(n.title),t.$select.find("option").removeAttr("selected").eq(r).prop("selected",!0).parent().trigger("change"),t.selected={index:e,title:n.title},t.focusIndex=i,typeof t.onChange=="function"&&t.onChange.call(t.$select[0],{title:n.title,value:n.value})},search:function(){var e=this,t=function(t){e.focusIndex=t,e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus"),e.scrollToView()},n=function(t){return e.options[t].title.toUpperCase()};for(i=0;i<e.options.length;i++){var r=n(i);if(r.indexOf(e.query)==0){t(i);return}}for(i=0;i<e.options.length;i++){var r=n(i);if(r.indexOf(e.query)>-1){t(i);break}}},scrollToView:function(){var e=this;if(e.focusIndex>=e.cutOff){var t=e.$items.eq(e.focusIndex),n=t.outerHeight()*(e.focusIndex+1)-e.maxHeight;e.$dropDown.scrollTop(n)}},notInViewport:function(e){var t=this,n={min:e,max:e+(window.innerHeight||document.documentElement.clientHeight)},r=t.$dropDown.offset().top+t.maxHeight;return r>=n.min&&r<=n.max?0:r-n.max+5},destroy:function(){var e=this;e.unbindHandlers(),e.$select.unwrap().siblings().remove(),e.$select.unwrap(),delete Object.getPrototypeOf(e).instances[e.$select[0].id]},disable:function(){var e=this;e.disabled=!0,e.$container.addClass("disabled"),e.$select.attr("disabled",!0),e.down||e.close()},enable:function(){var e=this;e.disabled=!1,e.$container.removeClass("disabled"),e.$select.attr("disabled",!1)}};var n=function(e,n){e.id=e.id?e.id:"EasyDropDown"+r();var i=new t;i.instances[e.id]||(i.instances[e.id]=i,i.init(e,n))},r=function(){return("00000"+(Math.random()*16777216<<0).toString(16)).substr(-6).toUpperCase()};e.fn.easyDropDown=function(){var e=arguments,r=[],i;return i=this.each(function(){if(e&&typeof e[0]=="string"){var i=t.prototype.instances[this.id][e[0]](e[1],e[2]);i&&r.push(i)}else n(this,e[0])}),r.length?r.length>1?r:r[0]:i},e(function(){typeof Object.getPrototypeOf!="function"&&(typeof "test".__proto__=="object"?Object.getPrototypeOf=function(e){return e.__proto__}:Object.getPrototypeOf=function(e){return e.constructor.prototype}),e("select.dropdown").each(function(){var t=e(this).attr("data-settings");settings=t?e.parseJSON(t):{},n(this,settings)})})})(jQuery),define("jquery.easydropdown",function(){});